<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elemental Duo - Complete Multiplayer Edition</title>
    <meta name="description" content="Play Elemental Duo online with friends - 15 cooperative puzzle levels">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: white;
        }

        .connection-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .connection-form {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            max-width: 450px;
            width: 90%;
        }

        .connection-form h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
        }

        .form-group {
            margin: 20px 0;
        }

        .form-group input {
            padding: 15px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            width: 100%;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
            transform: scale(1.02);
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            background: linear-gradient(45deg, #ff5252, #d63031);
        }

        .status-message {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .player-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 15px;
            z-index: 1500;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(78, 205, 196, 0.3);
        }

        .game-header {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(15px);
            border-bottom: 2px solid rgba(78, 205, 196, 0.3);
        }

        .game-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
        }

        .controls {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            font-size: 0.9em;
            flex-wrap: wrap;
        }

        .player-controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            margin: 5px;
            transition: all 0.3s ease;
        }

        .my-controls {
            border: 2px solid #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.4);
            background: rgba(78, 205, 196, 0.2);
        }

        #gameCanvas {
            flex: 1;
            background: linear-gradient(180deg, #87ceeb, #98fb98);
            border: 3px solid #333;
            display: block;
            margin: 0 auto;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .game-info {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(15px);
            border-top: 2px solid rgba(78, 205, 196, 0.3);
            font-size: 0.9em;
        }

        .level-complete {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 1000;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .level-complete h2 {
            margin-bottom: 15px;
            font-size: 2em;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        @media (max-width: 768px) {
            .game-header h1 {
                font-size: 1.8em;
            }
            
            .controls {
                font-size: 0.8em;
            }
            
            .connection-form {
                padding: 30px 20px;
            }
            
            .connection-form h1 {
                font-size: 2em;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Connection Screen -->
    <div id="connectionScreen" class="connection-screen">
        <div class="connection-form">
            <h1>üî•üíß Elemental Duo üíßüî•</h1>
            <p style="margin-bottom: 20px; opacity: 0.9;">Complete Online Multiplayer Edition<br>15 Cooperative Puzzle Levels</p>
            
            <div class="form-group">
                <input type="text" id="playerName" placeholder="Enter your name" maxlength="20" autocomplete="off">
            </div>
            
            <div class="form-group">
                <input type="text" id="roomId" placeholder="Room ID (or create new)" maxlength="20" autocomplete="off">
            </div>
            
            <button class="btn" onclick="window.joinGame()">üö™ Join Game</button>
            <button class="btn" onclick="window.createRoom()">üÜï Create Room</button>
            
            <div class="status-message" id="statusMessage">
                Enter your name and room ID to start your cooperative adventure!
            </div>
        </div>
    </div>

    <!-- Player Indicator -->
    <div id="playerIndicator" class="player-indicator" style="display: none;">
        <div id="playerInfo"></div>
        <div id="roomInfo"></div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" style="display: none;">
        <div class="game-header">
            <h1>üî•üíß Elemental Duo üíßüî•</h1>
            <div class="controls">
                <div class="player-controls" id="fireControls">
                    <strong>üî• Fire Player:</strong> WASD to move
                </div>
                <div class="player-controls" id="waterControls">
                    <strong>üíß Water Player:</strong> Arrow Keys to move
                </div>
            </div>
        </div>

        <canvas id="gameCanvas" width="1000" height="600"></canvas>

        <div class="game-info">
            <span id="levelInfo">Level 1 - Get both players to their colored doors!</span>
            <span style="margin-left: 30px;">üî• Fire Player ‚Üí Red Door | üíß Water Player ‚Üí Blue Door | Activate all switches and reach doors together!</span>
        </div>

        <div id="levelComplete" class="level-complete">
            <h2>üéâ Level Complete! üéâ</h2>
            <p id="levelCompleteText">Excellent teamwork! Ready for the next challenge?</p>
            <button class="btn" onclick="window.nextLevel()">‚û°Ô∏è Next Level</button>
            <button class="btn" onclick="window.restartLevel()">üîÑ Restart Level</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        console.log("üéÆ Elemental Duo - Complete Edition v2.2 Loading...");
        
        // Global variables
        let socket = null;
        let myPlayerType = null;
        let gameInitialized = false;
        let lastInputSent = { left: false, right: false, up: false };
        let inputBuffer = [];
        let frameCount = 0;

        // Game variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let currentLevel = 1;
        let gameState = 'playing';

        // Player objects with improved physics and prediction
        let firePlayer = {
            x: 50, y: 522, width: 28, height: 28, color: '#ff4757',
            speed: 4, maxSpeed: 6, velX: 0, velY: 0, acceleration: 0.5,
            friction: 0.8, jumpPower: 14, gravity: 0.6, maxFallSpeed: 12,
            jumping: false, onGround: false, onWall: false,
            keys: { left: false, right: false, up: false },
            serverX: 50, serverY: 522, serverVelX: 0, serverVelY: 0,
            lastServerUpdate: 0
        };

        let waterPlayer = {
            x: 100, y: 522, width: 28, height: 28, color: '#3742fa',
            speed: 4, maxSpeed: 6, velX: 0, velY: 0, acceleration: 0.5,
            friction: 0.8, jumpPower: 14, gravity: 0.6, maxFallSpeed: 12,
            jumping: false, onGround: false, onWall: false,
            keys: { left: false, right: false, up: false },
            serverX: 100, serverY: 522, serverVelX: 0, serverVelY: 0,
            lastServerUpdate: 0
        };

        // Complete levels data - All 15 levels with progressive difficulty
        const levels = [
            // Level 1: Basic Introduction
            {
                name: "First Steps",
                platforms: [
                    { x: 0, y: 550, width: 1000, height: 50, color: '#8b4513' },
                    { x: 200, y: 450, width: 150, height: 20, color: '#8b4513' },
                    { x: 450, y: 350, width: 150, height: 20, color: '#8b4513' },
                    { x: 700, y: 250, width: 150, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 300, y: 530, width: 80, height: 20, type: 'water', color: '#0074d9' },
                    { x: 600, y: 530, width: 80, height: 20, type: 'fire', color: '#ff4136' }
                ],
                doors: [
                    { x: 920, y: 500, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 960, y: 500, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: []
            },
            // Level 2: Switch Introduction
            {
                name: "Learning to Cooperate",
                platforms: [
                    { x: 0, y: 550, width: 1000, height: 50, color: '#8b4513' },
                    { x: 150, y: 450, width: 100, height: 20, color: '#8b4513' },
                    { x: 350, y: 400, width: 100, height: 20, color: '#8b4513' },
                    { x: 550, y: 350, width: 100, height: 20, color: '#8b4513' },
                    { x: 750, y: 300, width: 200, height: 20, color: '#8b4513' },
                    { x: 400, y: 200, width: 200, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 270, y: 530, width: 60, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 470, y: 530, width: 60, height: 20, type: 'water', color: '#0074d9' },
                    { x: 670, y: 530, width: 60, height: 20, type: 'fire', color: '#ff4136' }
                ],
                doors: [
                    { x: 430, y: 150, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 535, y: 150, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 200, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 800, y: 280, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' }
                ]
            },
            // Level 3: The Bridge Gap
            {
                name: "Bridge Building",
                platforms: [
                    { x: 0, y: 550, width: 200, height: 50, color: '#8b4513' },
                    { x: 300, y: 450, width: 100, height: 20, color: '#8b4513' },
                    { x: 500, y: 400, width: 100, height: 20, color: '#8b4513' },
                    { x: 700, y: 350, width: 300, height: 20, color: '#8b4513' },
                    { x: 800, y: 550, width: 200, height: 50, color: '#8b4513' }
                ],
                hazards: [
                    { x: 220, y: 530, width: 60, height: 20, type: 'water', color: '#0074d9' },
                    { x: 720, y: 530, width: 60, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 420, y: 380, width: 60, height: 20, type: 'fire', color: '#ff4136' }
                ],
                doors: [
                    { x: 930, y: 500, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 965, y: 500, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 50, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 850, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' }
                ]
            },
            // Level 4: Elevator Teamwork
            {
                name: "Rising Together",
                platforms: [
                    { x: 0, y: 550, width: 150, height: 50, color: '#8b4513' },
                    { x: 200, y: 350, width: 80, height: 20, color: '#8b4513' },
                    { x: 350, y: 450, width: 80, height: 20, color: '#8b4513' },
                    { x: 500, y: 250, width: 80, height: 20, color: '#8b4513' },
                    { x: 650, y: 400, width: 80, height: 20, color: '#8b4513' },
                    { x: 800, y: 150, width: 200, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 300, y: 430, width: 40, height: 20, type: 'water', color: '#0074d9' },
                    { x: 600, y: 380, width: 40, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 750, y: 130, width: 40, height: 20, type: 'water', color: '#0074d9' }
                ],
                doors: [
                    { x: 820, y: 100, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 865, y: 100, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 230, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 380, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 530, y: 230, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' }
                ]
            },
            // Level 5: The Split Path
            {
                name: "Divided We Stand",
                platforms: [
                    { x: 0, y: 550, width: 100, height: 50, color: '#8b4513' },
                    { x: 150, y: 450, width: 50, height: 20, color: '#8b4513' },
                    { x: 150, y: 350, width: 50, height: 20, color: '#8b4513' },
                    { x: 250, y: 250, width: 50, height: 20, color: '#8b4513' },
                    { x: 350, y: 150, width: 300, height: 20, color: '#8b4513' },
                    { x: 700, y: 250, width: 50, height: 20, color: '#8b4513' },
                    { x: 800, y: 350, width: 50, height: 20, color: '#8b4513' },
                    { x: 800, y: 450, width: 50, height: 20, color: '#8b4513' },
                    { x: 900, y: 550, width: 100, height: 50, color: '#8b4513' }
                ],
                hazards: [
                    { x: 120, y: 530, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 210, y: 430, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 760, y: 430, width: 30, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 870, y: 530, width: 20, height: 20, type: 'water', color: '#0074d9' }
                ],
                doors: [
                    { x: 450, y: 100, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 515, y: 100, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 280, y: 230, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 730, y: 230, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' }
                ]
            },
            // Level 6: Mirror Maze
            {
                name: "Reflection Chamber",
                platforms: [
                    { x: 0, y: 550, width: 100, height: 50, color: '#8b4513' },
                    { x: 150, y: 450, width: 100, height: 20, color: '#8b4513' },
                    { x: 300, y: 350, width: 100, height: 20, color: '#8b4513' },
                    { x: 450, y: 450, width: 100, height: 20, color: '#8b4513' },
                    { x: 600, y: 350, width: 100, height: 20, color: '#8b4513' },
                    { x: 750, y: 450, width: 100, height: 20, color: '#8b4513' },
                    { x: 900, y: 550, width: 100, height: 50, color: '#8b4513' },
                    { x: 400, y: 200, width: 200, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 120, y: 430, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 270, y: 430, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 420, y: 330, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 570, y: 330, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 720, y: 430, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 870, y: 430, width: 20, height: 20, type: 'fire', color: '#ff4136' }
                ],
                doors: [
                    { x: 450, y: 150, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 515, y: 150, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 50, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 930, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 480, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 630, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' }
                ]
            },
            // Level 7: The Tower Climb
            {
                name: "Spiral Ascension",
                platforms: [
                    { x: 0, y: 550, width: 200, height: 50, color: '#8b4513' },
                    { x: 250, y: 500, width: 80, height: 20, color: '#8b4513' },
                    { x: 380, y: 450, width: 80, height: 20, color: '#8b4513' },
                    { x: 510, y: 400, width: 80, height: 20, color: '#8b4513' },
                    { x: 640, y: 350, width: 80, height: 20, color: '#8b4513' },
                    { x: 500, y: 300, width: 80, height: 20, color: '#8b4513' },
                    { x: 360, y: 250, width: 80, height: 20, color: '#8b4513' },
                    { x: 220, y: 200, width: 80, height: 20, color: '#8b4513' },
                    { x: 400, y: 100, width: 200, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 220, y: 530, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 340, y: 480, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 470, y: 430, width: 30, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 600, y: 380, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 450, y: 280, width: 40, height: 20, type: 'fire', color: '#ff4136' }
                ],
                doors: [
                    { x: 450, y: 50, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 515, y: 50, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 280, y: 480, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 410, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 540, y: 380, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 250, y: 180, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' }
                ]
            },
            // Level 8: Hazard Highway
            {
                name: "Dangerous Crossing",
                platforms: [
                    { x: 0, y: 550, width: 100, height: 50, color: '#8b4513' },
                    { x: 150, y: 450, width: 60, height: 20, color: '#8b4513' },
                    { x: 260, y: 350, width: 60, height: 20, color: '#8b4513' },
                    { x: 370, y: 250, width: 60, height: 20, color: '#8b4513' },
                    { x: 480, y: 350, width: 60, height: 20, color: '#8b4513' },
                    { x: 590, y: 450, width: 60, height: 20, color: '#8b4513' },
                    { x: 700, y: 350, width: 60, height: 20, color: '#8b4513' },
                    { x: 810, y: 250, width: 60, height: 20, color: '#8b4513' },
                    { x: 900, y: 450, width: 100, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 120, y: 430, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 230, y: 330, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 340, y: 230, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 450, y: 330, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 560, y: 430, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 670, y: 330, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 780, y: 230, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 870, y: 430, width: 20, height: 20, type: 'fire', color: '#ff4136' }
                ],
                doors: [
                    { x: 920, y: 400, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 955, y: 400, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 50, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 180, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 400, y: 230, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 730, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' }
                ]
            },
            // Level 9: The Great Divide
            {
                name: "Chasm Challenge",
                platforms: [
                    { x: 0, y: 550, width: 150, height: 50, color: '#8b4513' },
                    { x: 200, y: 400, width: 100, height: 200, color: '#8b4513' },
                    { x: 350, y: 300, width: 100, height: 20, color: '#8b4513' },
                    { x: 550, y: 300, width: 100, height: 20, color: '#8b4513' },
                    { x: 700, y: 400, width: 100, height: 200, color: '#8b4513' },
                    { x: 850, y: 550, width: 150, height: 50, color: '#8b4513' },
                    { x: 100, y: 200, width: 80, height: 20, color: '#8b4513' },
                    { x: 820, y: 200, width: 80, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 320, y: 580, width: 360, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 380, y: 280, width: 40, height: 20, type: 'water', color: '#0074d9' },
                    { x: 580, y: 280, width: 40, height: 20, type: 'fire', color: '#ff4136' }
                ],
                doors: [
                    { x: 130, y: 150, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 835, y: 150, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 250, y: 380, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 750, y: 380, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 400, y: 280, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 600, y: 280, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' }
                ]
            },
            // Level 10: Switch Symphony
            {
                name: "Harmonic Cooperation",
                platforms: [
                    { x: 0, y: 550, width: 120, height: 50, color: '#8b4513' },
                    { x: 170, y: 450, width: 80, height: 20, color: '#8b4513' },
                    { x: 300, y: 350, width: 80, height: 20, color: '#8b4513' },
                    { x: 430, y: 250, width: 80, height: 20, color: '#8b4513' },
                    { x: 560, y: 350, width: 80, height: 20, color: '#8b4513' },
                    { x: 690, y: 450, width: 80, height: 20, color: '#8b4513' },
                    { x: 820, y: 550, width: 120, height: 50, color: '#8b4513' },
                    { x: 400, y: 100, width: 200, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 140, y: 530, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 270, y: 430, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 400, y: 330, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 530, y: 330, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 660, y: 430, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 790, y: 530, width: 20, height: 20, type: 'water', color: '#0074d9' }
                ],
                doors: [
                    { x: 450, y: 50, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 515, y: 50, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 60, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 200, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 330, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 460, y: 230, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 590, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 720, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 880, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' }
                ]
            },
            // Level 11: The Gauntlet
            {
                name: "Ultimate Gauntlet",
                platforms: [
                    { x: 0, y: 550, width: 80, height: 50, color: '#8b4513' },
                    { x: 120, y: 480, width: 60, height: 20, color: '#8b4513' },
                    { x: 220, y: 400, width: 60, height: 20, color: '#8b4513' },
                    { x: 320, y: 320, width: 60, height: 20, color: '#8b4513' },
                    { x: 420, y: 240, width: 60, height: 20, color: '#8b4513' },
                    { x: 520, y: 160, width: 60, height: 20, color: '#8b4513' },
                    { x: 620, y: 240, width: 60, height: 20, color: '#8b4513' },
                    { x: 720, y: 320, width: 60, height: 20, color: '#8b4513' },
                    { x: 820, y: 400, width: 60, height: 20, color: '#8b4513' },
                    { x: 920, y: 550, width: 80, height: 50, color: '#8b4513' }
                ],
                hazards: [
                    { x: 90, y: 460, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 190, y: 380, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 290, y: 300, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 390, y: 220, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 490, y: 140, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 590, y: 220, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 690, y: 300, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 790, y: 380, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 890, y: 530, width: 20, height: 20, type: 'water', color: '#0074d9' }
                ],
                doors: [
                    { x: 930, y: 500, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 965, y: 500, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 40, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 150, y: 460, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 250, y: 380, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 350, y: 300, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 450, y: 220, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 550, y: 140, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' }
                ]
            },
            // Level 12: Chamber of Cooperation
            {
                name: "Cooperation Chambers",
                platforms: [
                    { x: 0, y: 550, width: 100, height: 50, color: '#8b4513' },
                    { x: 150, y: 450, width: 50, height: 100, color: '#8b4513' },
                    { x: 250, y: 350, width: 50, height: 200, color: '#8b4513' },
                    { x: 350, y: 400, width: 300, height: 20, color: '#8b4513' },
                    { x: 700, y: 350, width: 50, height: 200, color: '#8b4513' },
                    { x: 800, y: 450, width: 50, height: 100, color: '#8b4513' },
                    { x: 900, y: 550, width: 100, height: 50, color: '#8b4513' },
                    { x: 400, y: 250, width: 200, height: 20, color: '#8b4513' },
                    { x: 450, y: 150, width: 100, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 120, y: 530, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 220, y: 430, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 320, y: 380, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 670, y: 380, width: 20, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 770, y: 430, width: 20, height: 20, type: 'water', color: '#0074d9' },
                    { x: 870, y: 530, width: 20, height: 20, type: 'fire', color: '#ff4136' }
                ],
                doors: [
                    { x: 470, y: 100, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 495, y: 100, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 50, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 175, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 275, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 430, y: 230, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 570, y: 230, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 725, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 825, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 950, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' }
                ]
            },
            // Level 13: The Elemental Crucible
            {
                name: "Elemental Crucible",
                platforms: [
                    { x: 0, y: 550, width: 80, height: 50, color: '#8b4513' },
                    { x: 120, y: 500, width: 40, height: 20, color: '#8b4513' },
                    { x: 200, y: 450, width: 40, height: 20, color: '#8b4513' },
                    { x: 280, y: 400, width: 40, height: 20, color: '#8b4513' },
                    { x: 360, y: 350, width: 40, height: 20, color: '#8b4513' },
                    { x: 440, y: 300, width: 120, height: 20, color: '#8b4513' },
                    { x: 600, y: 350, width: 40, height: 20, color: '#8b4513' },
                    { x: 680, y: 400, width: 40, height: 20, color: '#8b4513' },
                    { x: 760, y: 450, width: 40, height: 20, color: '#8b4513' },
                    { x: 840, y: 500, width: 40, height: 20, color: '#8b4513' },
                    { x: 920, y: 550, width: 80, height: 50, color: '#8b4513' },
                    { x: 300, y: 200, width: 400, height: 20, color: '#8b4513' },
                    { x: 450, y: 100, width: 100, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 100, y: 480, width: 15, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 165, y: 480, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 245, y: 430, width: 30, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 325, y: 380, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 405, y: 330, width: 30, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 565, y: 330, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 645, y: 380, width: 30, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 725, y: 430, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 805, y: 480, width: 30, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 885, y: 480, width: 15, height: 20, type: 'water', color: '#0074d9' },
                    { x: 350, y: 180, width: 40, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 610, y: 180, width: 40, height: 20, type: 'water', color: '#0074d9' }
                ],
                doors: [
                    { x: 470, y: 50, width: 35, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 495, y: 50, width: 35, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 40, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 140, y: 480, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 220, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 380, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 520, y: 280, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 620, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 780, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 860, y: 480, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 960, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' }
                ]
            },
            // Level 14: Trial of Elements
            {
                name: "Trial of Elements",
                platforms: [
                    { x: 0, y: 550, width: 60, height: 50, color: '#8b4513' },
                    { x: 100, y: 500, width: 30, height: 20, color: '#8b4513' },
                    { x: 170, y: 450, width: 30, height: 20, color: '#8b4513' },
                    { x: 240, y: 400, width: 30, height: 20, color: '#8b4513' },
                    { x: 310, y: 350, width: 30, height: 20, color: '#8b4513' },
                    { x: 380, y: 300, width: 30, height: 20, color: '#8b4513' },
                    { x: 450, y: 250, width: 100, height: 20, color: '#8b4513' },
                    { x: 590, y: 300, width: 30, height: 20, color: '#8b4513' },
                    { x: 660, y: 350, width: 30, height: 20, color: '#8b4513' },
                    { x: 730, y: 400, width: 30, height: 20, color: '#8b4513' },
                    { x: 800, y: 450, width: 30, height: 20, color: '#8b4513' },
                    { x: 870, y: 500, width: 30, height: 20, color: '#8b4513' },
                    { x: 940, y: 550, width: 60, height: 50, color: '#8b4513' },
                    { x: 200, y: 200, width: 600, height: 20, color: '#8b4513' },
                    { x: 350, y: 100, width: 300, height: 20, color: '#8b4513' },
                    { x: 475, y: 50, width: 50, height: 20, color: '#8b4513' }
                ],
                hazards: [
                    { x: 80, y: 480, width: 15, height: 20, type: 'water', color: '#0074d9' },
                    { x: 140, y: 480, width: 25, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 210, y: 430, width: 25, height: 20, type: 'water', color: '#0074d9' },
                    { x: 280, y: 380, width: 25, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 350, y: 330, width: 25, height: 20, type: 'water', color: '#0074d9' },
                    { x: 415, y: 280, width: 30, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 555, y: 280, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 625, y: 330, width: 25, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 695, y: 380, width: 25, height: 20, type: 'water', color: '#0074d9' },
                    { x: 765, y: 430, width: 25, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 835, y: 480, width: 25, height: 20, type: 'water', color: '#0074d9' },
                    { x: 905, y: 480, width: 15, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 250, y: 180, width: 30, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 320, y: 180, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 450, y: 180, width: 30, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 520, y: 180, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 650, y: 180, width: 30, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 720, y: 180, width: 30, height: 20, type: 'water', color: '#0074d9' },
                    { x: 400, y: 80, width: 40, height: 20, type: 'fire', color: '#ff4136' },
                    { x: 560, y: 80, width: 40, height: 20, type: 'water', color: '#0074d9' }
                ],
                doors: [
                    { x: 485, y: 0, width: 20, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 495, y: 0, width: 20, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 30, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 110, y: 480, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 180, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 250, y: 380, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 320, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 390, y: 280, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 480, y: 230, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 500, y: 230, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 610, y: 280, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 680, y: 330, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 750, y: 380, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 820, y: 430, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 890, y: 480, width: 20, height: 20, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 970, y: 530, width: 20, height: 20, activated: false, requiredPlayer: 'water', color: '#82b1ff' }
                ]
            },
            // Level 15: The Final Elemental Challenge
            {
                platforms: [
                    { x: 0, y: 550, width: 50, height: 50, color: '#8b4513' },
                    { x: 80, y: 520, width: 25, height: 15, color: '#8b4513' },
                    { x: 130, y: 490, width: 25, height: 15, color: '#8b4513' },
                    { x: 180, y: 460, width: 25, height: 15, color: '#8b4513' },
                    { x: 230, y: 430, width: 25, height: 15, color: '#8b4513' },
                    { x: 280, y: 400, width: 25, height: 15, color: '#8b4513' },
                    { x: 330, y: 370, width: 25, height: 15, color: '#8b4513' },
                    { x: 380, y: 340, width: 25, height: 15, color: '#8b4513' },
                    { x: 430, y: 310, width: 25, height: 15, color: '#8b4513' },
                    { x: 480, y: 280, width: 40, height: 15, color: '#8b4513' },
                    { x: 550, y: 310, width: 25, height: 15, color: '#8b4513' },
                    { x: 600, y: 340, width: 25, height: 15, color: '#8b4513' },
                    { x: 650, y: 370, width: 25, height: 15, color: '#8b4513' },
                    { x: 700, y: 400, width: 25, height: 15, color: '#8b4513' },
                    { x: 750, y: 430, width: 25, height: 15, color: '#8b4513' },
                    { x: 800, y: 460, width: 25, height: 15, color: '#8b4513' },
                    { x: 850, y: 490, width: 25, height: 15, color: '#8b4513' },
                    { x: 900, y: 520, width: 25, height: 15, color: '#8b4513' },
                    { x: 950, y: 550, width: 50, height: 50, color: '#8b4513' },
                    { x: 200, y: 250, width: 600, height: 15, color: '#8b4513' },
                    { x: 300, y: 150, width: 400, height: 15, color: '#8b4513' },
                    { x: 400, y: 50, width: 200, height: 15, color: '#8b4513' },
                    { x: 480, y: 0, width: 40, height: 15, color: '#8b4513' }
                ],
                hazards: [
                    { x: 60, y: 500, width: 15, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 110, y: 470, width: 15, height: 15, type: 'water', color: '#0074d9' },
                    { x: 160, y: 440, width: 15, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 210, y: 410, width: 15, height: 15, type: 'water', color: '#0074d9' },
                    { x: 260, y: 380, width: 15, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 310, y: 350, width: 15, height: 15, type: 'water', color: '#0074d9' },
                    { x: 360, y: 320, width: 15, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 410, y: 290, width: 15, height: 15, type: 'water', color: '#0074d9' },
                    { x: 465, y: 260, width: 15, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 505, y: 260, width: 15, height: 15, type: 'water', color: '#0074d9' },
                    { x: 530, y: 290, width: 15, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 580, y: 320, width: 15, height: 15, type: 'water', color: '#0074d9' },
                    { x: 630, y: 350, width: 15, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 680, y: 380, width: 15, height: 15, type: 'water', color: '#0074d9' },
                    { x: 730, y: 410, width: 15, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 780, y: 440, width: 15, height: 15, type: 'water', color: '#0074d9' },
                    { x: 830, y: 470, width: 15, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 880, y: 500, width: 15, height: 15, type: 'water', color: '#0074d9' },
                    { x: 925, y: 500, width: 15, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 250, y: 230, width: 20, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 300, y: 230, width: 20, height: 15, type: 'water', color: '#0074d9' },
                    { x: 380, y: 230, width: 20, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 430, y: 230, width: 20, height: 15, type: 'water', color: '#0074d9' },
                    { x: 520, y: 230, width: 20, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 570, y: 230, width: 20, height: 15, type: 'water', color: '#0074d9' },
                    { x: 650, y: 230, width: 20, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 700, y: 230, width: 20, height: 15, type: 'water', color: '#0074d9' },
                    { x: 350, y: 130, width: 25, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 420, y: 130, width: 25, height: 15, type: 'water', color: '#0074d9' },
                    { x: 500, y: 130, width: 25, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 580, y: 130, width: 25, height: 15, type: 'water', color: '#0074d9' },
                    { x: 650, y: 130, width: 25, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 430, y: 30, width: 20, height: 15, type: 'fire', color: '#ff4136' },
                    { x: 550, y: 30, width: 20, height: 15, type: 'water', color: '#0074d9' }
                ],
                doors: [
                    { x: 490, y: -50, width: 15, height: 50, type: 'fire', color: '#ff4757' },
                    { x: 505, y: -50, width: 15, height: 50, type: 'water', color: '#3742fa' }
                ],
                switches: [
                    { x: 25, y: 530, width: 15, height: 15, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 90, y: 500, width: 15, height: 15, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 140, y: 470, width: 15, height: 15, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 190, y: 440, width: 15, height: 15, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 240, y: 410, width: 15, height: 15, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 290, y: 380, width: 15, height: 15, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 340, y: 350, width: 15, height: 15, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 390, y: 320, width: 15, height: 15, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 440, y: 290, width: 15, height: 15, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 490, y: 260, width: 15, height: 15, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 505, y: 260, width: 15, height: 15, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 560, y: 290, width: 15, height: 15, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 610, y: 320, width: 15, height: 15, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 660, y: 350, width: 15, height: 15, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 710, y: 380, width: 15, height: 15, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 760, y: 410, width: 15, height: 15, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 810, y: 440, width: 15, height: 15, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 860, y: 470, width: 15, height: 15, activated: false, requiredPlayer: 'fire', color: '#ff8a80' },
                    { x: 910, y: 500, width: 15, height: 15, activated: false, requiredPlayer: 'water', color: '#82b1ff' },
                    { x: 975, y: 530, width: 15, height: 15, activated: false, requiredPlayer: 'fire', color: '#ff8a80' }
                ]
            }
        ];
        
        let currentLevelData = levels[currentLevel - 1];

        // GLOBAL FUNCTIONS - Make sure these are accessible from HTML onclick
        window.createRoom = function() {
            console.log("üÜï Create room button clicked");
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                showStatus('Please enter your name!');
                return;
            }
            
            const roomId = Math.random().toString(36).substring(2, 8).toUpperCase();
            document.getElementById('roomId').value = roomId;
            showStatus(`Creating room ${roomId}...`);
            joinGame();
        };

        window.joinGame = function() {
            console.log("üö™ Join game function called");
            const playerName = document.getElementById('playerName').value.trim();
            const roomId = document.getElementById('roomId').value.trim().toUpperCase();
            
            if (!playerName || !roomId) {
                showStatus('Please enter both your name and room ID!');
                return;
            }

            console.log(`Attempting to join room: ${roomId} as ${playerName}`);

            // Prevent multiple connections
            if (socket && socket.connected) {
                console.log("Disconnecting existing socket");
                socket.disconnect();
            }

            showStatus('Connecting to server...');
            
            // Initialize socket with better error handling
            try {
                socket = io({
                    transports: ['websocket', 'polling'],
                    timeout: 20000,
                    forceNew: true
                });
                console.log("Socket created successfully");
            } catch (error) {
                console.error("Failed to create socket:", error);
                showStatus('‚ùå Failed to initialize connection');
                return;
            }

            // Connection timeout
            const connectionTimeout = setTimeout(() => {
                if (!socket || !socket.connected) {
                    showStatus('‚ùå Connection timeout. Please try again or check your internet connection.');
                    if (socket) socket.disconnect();
                }
            }, 15000);
            
            socket.on('connect', () => {
                clearTimeout(connectionTimeout);
                console.log('üîå Connected to server with ID:', socket.id);
                showStatus('Connected! Joining room...');
                socket.emit('joinRoom', { roomId: roomId, playerName: playerName });
            });

            socket.on('connect_error', (error) => {
                clearTimeout(connectionTimeout);
                console.error('Connection error:', error);
                showStatus('‚ùå Failed to connect to server. Please refresh and try again.');
            });

            socket.on('playerAssigned', (data) => {
                myPlayerType = data.playerType;
                console.log(`üéÆ Assigned as ${data.playerType} player in room ${data.roomId}`);
                
                const statusMsg = data.playersCount === 2 
                    ? `You are the ${data.playerType} player! Starting game...`
                    : `You are the ${data.playerType} player! Waiting for partner... (Share room ID: ${data.roomId})`;
                    
                showStatus(statusMsg);
                
                updatePlayerIndicator(data);
                
                if (data.playersCount === 2) {
                    setTimeout(startGame, 1500);
                }
            });

            socket.on('playerJoined', (data) => {
                console.log(`ü§ù ${data.playerType} player joined. Total players: ${data.playersCount}`);
                showStatus('Partner joined! Starting game...');
                setTimeout(startGame, 1500);
            });

            socket.on('roomFull', () => {
                console.log('‚ùå Room full error received');
                showStatus('‚ùå Room is full! Try a different room ID.');
                setTimeout(() => {
                    if (socket) socket.disconnect();
                }, 2000);
            });

            socket.on('error', (error) => {
                console.error('Socket error:', error);
                showStatus('‚ùå An error occurred: ' + (error.message || 'Unknown error'));
            });

            socket.on('playerLeft', (data) => {
                console.log('Player left:', data);
                showStatus(`üòû ${data.playerType} player left the game. Waiting for new partner...`);
                
                if (gameInitialized) {
                    document.getElementById('gameScreen').style.display = 'none';
                    document.getElementById('connectionScreen').style.display = 'flex';
                    gameInitialized = false;
                }
            });

            socket.on('playerInput', (data) => {
                if (data.playerType !== myPlayerType) {
                    const targetPlayer = data.playerType === 'fire' ? firePlayer : waterPlayer;
                    targetPlayer.keys = data.keys;
                    targetPlayer.lastServerUpdate = Date.now();
                }
            });

            socket.on('levelComplete', () => {
                document.getElementById('levelComplete').style.display = 'block';
                gameState = 'complete';
            });

            socket.on('restartLevel', () => {
                resetLevel();
            });

            socket.on('nextLevel', () => {
                if (currentLevel < levels.length) {
                    currentLevel++;
                    currentLevelData = levels[currentLevel - 1];
                    document.getElementById('levelInfo').textContent = `Level ${currentLevel} - Get both players to their colored doors!`;
                }
                resetLevel();
                document.getElementById('levelComplete').style.display = 'none';
                gameState = 'playing';
            });

            socket.on('disconnect', (reason) => {
                console.log('üîå Disconnected from server. Reason:', reason);
                showStatus('üîå Disconnected from server. Refresh to reconnect.');
                
                if (gameInitialized) {
                    document.getElementById('gameScreen').style.display = 'none';
                    document.getElementById('connectionScreen').style.display = 'flex';
                    gameInitialized = false;
                }
            });
        };

        window.nextLevel = function() {
            if (currentLevel < levels.length) {
                currentLevel++;
                currentLevelData = levels[currentLevel - 1];
                document.getElementById('levelInfo').textContent = `Level ${currentLevel} - Get both players to their colored doors!`;
                resetLevel();
            } else {
                showStatus('üéâ Congratulations! You completed all levels together! üéâ');
                currentLevel = 1;
                currentLevelData = levels[0];
                document.getElementById('levelInfo').textContent = 'Level 1 - Get both players to their colored doors!';
                resetLevel();
            }
            
            if (socket && myPlayerType) {
                socket.emit('nextLevel');
            }
            document.getElementById('levelComplete').style.display = 'none';
            gameState = 'playing';
        };

        window.restartLevel = function() {
            document.getElementById('levelComplete').style.display = 'none';
            resetLevel();
        };

        function showStatus(message) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            console.log('Status:', message);
        }

        function updatePlayerIndicator(data) {
            document.getElementById('playerInfo').innerHTML = `You: ${myPlayerType === 'fire' ? 'üî•' : 'üíß'} ${myPlayerType}`;
            document.getElementById('roomInfo').innerHTML = `Room: ${data.roomId}<br>Players: ${data.playersCount}/2`;
            document.getElementById('playerIndicator').style.display = 'block';
            
            document.getElementById('fireControls').classList.remove('my-controls');
            document.getElementById('waterControls').classList.remove('my-controls');
            
            if (myPlayerType === 'fire') {
                document.getElementById('fireControls').classList.add('my-controls');
            } else if (myPlayerType === 'water') {
                document.getElementById('waterControls').classList.add('my-controls');
            }
        }

        function startGame() {
            console.log('üéÆ Starting game...');
            document.getElementById('connectionScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'flex';
            gameInitialized = true;
            
            resetLevel();
            gameLoop();
        }

        // Input handling
        const keys = {};
        let inputSendCooldown = 0;
        const INPUT_SEND_RATE = 3;

        document.addEventListener('keydown', (e) => {
            if (!gameInitialized || !myPlayerType) return;
            
            const key = e.key.toLowerCase();
            if (!keys[key]) {
                keys[key] = true;
                
                if ((myPlayerType === 'fire' && ['w', 'a', 's', 'd'].includes(key)) ||
                    (myPlayerType === 'water' && ['arrowup', 'arrowdown', 'arrowleft', 'arrowright'].includes(key))) {
                    e.preventDefault();
                }
                
                updateMyPlayerInput();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (!gameInitialized || !myPlayerType) return;
            
            const key = e.key.toLowerCase();
            if (keys[key]) {
                keys[key] = false;
                
                if ((myPlayerType === 'fire' && ['w', 'a', 's', 'd'].includes(key)) ||
                    (myPlayerType === 'water' && ['arrowup', 'arrowdown', 'arrowleft', 'arrowright'].includes(key))) {
                    e.preventDefault();
                }
                
                updateMyPlayerInput();
            }
        });

        function updateMyPlayerInput() {
            let currentKeys = { left: false, right: false, up: false };
            
            if (myPlayerType === 'fire') {
                currentKeys.left = keys['a'] || false;
                currentKeys.right = keys['d'] || false;
                currentKeys.up = keys['w'] || false;
            } else if (myPlayerType === 'water') {
                currentKeys.left = keys['arrowleft'] || false;
                currentKeys.right = keys['arrowright'] || false;
                currentKeys.up = keys['arrowup'] || false;
            }

            if (myPlayerType === 'fire') {
                firePlayer.keys = currentKeys;
            } else if (myPlayerType === 'water') {
                waterPlayer.keys = currentKeys;
            }

            if (inputSendCooldown <= 0 && JSON.stringify(currentKeys) !== JSON.stringify(lastInputSent)) {
                if (socket && socket.connected) {
                    socket.emit('playerInput', currentKeys);
                }
                lastInputSent = { ...currentKeys };
                inputSendCooldown = INPUT_SEND_RATE;
            }
        }

        // Simple physics for testing
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        function updatePlayer(player, otherPlayer) {
            const prevX = player.x;
            const prevY = player.y;
            
            if (player.keys.left) {
                player.velX -= player.acceleration;
                if (player.velX < -player.maxSpeed) player.velX = -player.maxSpeed;
            } else if (player.keys.right) {
                player.velX += player.acceleration;
                if (player.velX > player.maxSpeed) player.velX = player.maxSpeed;
            } else {
                player.velX *= player.friction;
                if (Math.abs(player.velX) < 0.1) player.velX = 0;
            }
            
            player.x += player.velX;
            
            let hitWall = false;
            for (let platform of currentLevelData.platforms) {
                if (checkCollision(player, platform)) {
                    if (player.velX > 0) {
                        player.x = platform.x - player.width;
                    } else if (player.velX < 0) {
                        player.x = platform.x + platform.width;
                    }
                    player.velX = 0;
                    hitWall = true;
                    break;
                }
            }
            player.onWall = hitWall;
            
            if (checkCollision(player, otherPlayer)) {
                if (player.velX > 0) {
                    player.x = otherPlayer.x - player.width;
                } else if (player.velX < 0) {
                    player.x = otherPlayer.x + otherPlayer.width;
                }
                player.velX *= 0.5;
            }
            
            if (player.keys.up && (player.onGround || (player.onWall && !player.onGround))) {
                if (!player.jumping || player.onGround) {
                    player.velY = -player.jumpPower;
                    player.jumping = true;
                    player.onGround = false;
                    
                    if (player.onWall && !player.onGround) {
                        player.velX += player.keys.left ? 4 : -4;
                    }
                }
            }
            
            if (!player.keys.up && player.jumping && player.velY < -3) {
                player.velY *= 0.6;
            }
            
            player.velY += player.gravity;
            if (player.velY > player.maxFallSpeed) {
                player.velY = player.maxFallSpeed;
            }
            
            player.y += player.velY;
            
            player.onGround = false;
            for (let platform of currentLevelData.platforms) {
                if (checkCollision(player, platform)) {
                    if (player.velY > 0) {
                        player.y = platform.y - player.height;
                        player.velY = 0;
                        player.onGround = true;
                        player.jumping = false;
                    } else if (player.velY < 0) {
                        player.y = platform.y + platform.height;
                        player.velY = 0;
                    }
                    break;
                }
            }
            
            if (checkCollision(player, otherPlayer)) {
                if (player.velY > 0 && prevY < otherPlayer.y) {
                    player.y = otherPlayer.y - player.height;
                    player.velY = 0;
                    player.onGround = true;
                    player.jumping = false;
                } else if (player.velY < 0 && prevY > otherPlayer.y) {
                    player.y = otherPlayer.y + otherPlayer.height;
                    player.velY = 0;
                }
            }
            
            if (player.x < 0) {
                player.x = 0;
                player.velX = 0;
            }
            if (player.x + player.width > canvas.width) {
                player.x = canvas.width - player.width;
                player.velX = 0;
            }
            
            if (player.y > canvas.height + 100) {
                resetLevel();
            }
        }

        function drawLevel() {
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87ceeb');
            gradient.addColorStop(1, '#98fb98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            for (let platform of currentLevelData.platforms) {
                ctx.fillStyle = platform.color;
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            }
            
            for (let hazard of currentLevelData.hazards) {
                ctx.fillStyle = hazard.color;
                ctx.fillRect(hazard.x, hazard.y, hazard.width, hazard.height);
            }
            
            for (let door of currentLevelData.doors) {
                ctx.fillStyle = door.color;
                ctx.fillRect(door.x, door.y, door.width, door.height);
                
                ctx.fillStyle = 'white';
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(door.type === 'fire' ? 'üî•' : 'üíß', 
                           door.x + door.width/2, door.y + door.height/2 + 8);
            }
        }

        function drawPlayer(player, emoji) {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(player.x + 2, player.y + player.height + 2, player.width, 4);
            
            const gradient = ctx.createLinearGradient(player.x, player.y, player.x, player.y + player.height);
            gradient.addColorStop(0, player.color);
            gradient.addColorStop(1, player.color === '#ff4757' ? '#ff3742' : '#2f3542');
            ctx.fillStyle = gradient;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.strokeRect(player.x, player.y, player.width, player.height);
            
            ctx.fillStyle = 'white';
            ctx.font = '18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(emoji, player.x + player.width/2, player.y + player.height/2 + 5);
        }

        function checkWinCondition() {
            if (!currentLevelData || !currentLevelData.doors) return;
            
            let fireAtDoor = false;
            let waterAtDoor = false;
            
            for (let door of currentLevelData.doors) {
                if (door.type === 'fire' &&
                    firePlayer.x < door.x + door.width &&
                    firePlayer.x + firePlayer.width > door.x &&
                    firePlayer.y < door.y + door.height &&
                    firePlayer.y + firePlayer.height > door.y) {
                    fireAtDoor = true;
                }
                
                if (door.type === 'water' &&
                    waterPlayer.x < door.x + door.width &&
                    waterPlayer.x + waterPlayer.width > door.x &&
                    waterPlayer.y < door.y + door.height &&
                    waterPlayer.y + waterPlayer.height > door.y) {
                    waterAtDoor = true;
                }
            }
            
            if (fireAtDoor && waterAtDoor && gameState === 'playing') {
                if (socket && socket.connected) {
                    socket.emit('levelComplete');
                }
                document.getElementById('levelComplete').style.display = 'block';
                gameState = 'complete';
            }
        }

        function gameLoop() {
            if (!gameInitialized) return;
            
            frameCount++;
            
            if (inputSendCooldown > 0) {
                inputSendCooldown--;
            }
            
            if (gameState === 'playing') {
                if (myPlayerType === 'fire') {
                    updatePlayer(firePlayer, waterPlayer);
                    updatePlayer(waterPlayer, firePlayer);
                } else if (myPlayerType === 'water') {
                    updatePlayer(waterPlayer, firePlayer);
                    updatePlayer(firePlayer, waterPlayer);
                }
                
                checkWinCondition();
            }
            
            drawLevel();
            drawPlayer(firePlayer, 'üî•');
            drawPlayer(waterPlayer, 'üíß');
            
            requestAnimationFrame(gameLoop);
        }

        function resetLevel() {
            firePlayer.x = 50;
            firePlayer.y = 522;
            firePlayer.velX = 0;
            firePlayer.velY = 0;
            firePlayer.onGround = false;
            firePlayer.jumping = false;
            
            waterPlayer.x = 100;
            waterPlayer.y = 522;
            waterPlayer.velX = 0;
            waterPlayer.velY = 0;
            waterPlayer.onGround = false;
            waterPlayer.jumping = false;
            
            gameState = 'playing';
            if (socket && myPlayerType && socket.connected) {
                socket.emit('restartLevel');
            }
        }

        // Enter key support for easier room joining
        document.addEventListener('DOMContentLoaded', function() {
            const playerNameInput = document.getElementById('playerName');
            const roomIdInput = document.getElementById('roomId');
            
            playerNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    roomIdInput.focus();
                }
            });
            
            roomIdInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    window.joinGame();
                }
            });
            
            playerNameInput.focus();
        });

        console.log("üéÆ Elemental Duo - Complete Edition v2.2 Ready!");
    </script>
</body>